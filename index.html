<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B1_M5_001_Les diverses cotisations sociales</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Random colors for accents, neutral background -->
    <!-- Application Structure Plan: Ce document est structur√© comme un guide interactif de formation. Une barre de progression visuelle en haut permet de suivre l'avancement. Le contenu est divis√© en sections th√©matiques (Introduction, Cotisations URSSAF, Cotisations AGIRC-ARRCO, Mutuelle et Pr√©voyance, Contributions Patronales Annuelles, Essentiel), chacune √©tant initialement verrouill√©e sauf la premi√®re. Pour d√©bloquer la section suivante, l'utilisateur doit r√©ussir un mini-quiz (2-3 questions) associ√© √† la section courante avec un score de 100%. Une fois toutes les sections valid√©es, le quiz final devient accessible. Cette approche gamifi√©e, avec des retours visuels et des validations par mini-quiz, assure une lecture active et une compr√©hension approfondie avant de passer au module suivant, rendant l'apprentissage ludique et efficace. -->
    <!-- Visualization & Content Choices: 
        - Barre de Progression (HTML/CSS): Objectif: Informer, Engager. Des cercles color√©s indiquent l'√©tat de chaque section (verrouill√©e, active, compl√©t√©e), offrant un feedback visuel imm√©diat sur l'avancement.
        - Sections th√©matiques (HTML/CSS/JS - Accordions avec verrouillage): Objectif: Organiser, Informer, Guider. Les sections sont encapsul√©es dans des conteneurs qui g√®rent leur √©tat (verrouill√©/d√©verrouill√©) via des classes CSS (opacit√©, pointer-events). Les accord√©ons permettent de masquer/afficher le contenu.
        - Mini-Quiz par Section (HTML/CSS/JS): Objectif: √âvaluer, Renforcer. Chaque section a son propre mini-quiz. La r√©ussite √† 100% est obligatoire pour la validation. Cela force l'utilisateur √† assimiler le contenu avant de progresser. Le quiz final est conditionn√© par la validation de toutes les sections.
        - Texte d√©taill√© avec mise en gras et emojis: Objectif: Informer, Engager. La mise en gras souligne les concepts cl√©s, et les emojis ajoutent une touche visuelle et ludique.
        - Quiz Principal (HTML/CSS/JS): Objectif: √âvaluer, Renforcer. Le quiz complet est d√©bloqu√© √† la fin du parcours, avec des justifications d√©taill√©es pour chaque r√©ponse, bas√©es sur des sources r√©glementaires.
        - Couleurs et Pep (Tailwind CSS): Utilisation de couleurs al√©atoires pour les boutons, les bordures, les arri√®re-plans subtils et les ic√¥nes, rendant l'interface plus dynamique et "beau gosse".
        - Justification: Ces choix visent √† transformer un sujet r√©glementaire complexe en une exp√©rience d'apprentissage interactive, structur√©e et motivante, sans recourir √† des images ou des SVG. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F8F8; /* Light gray background */
            color: #333333; /* Dark gray text */
        }
        .quiz-option input[type="radio"]:checked + label {
            background-color: var(--accent-dark-color); /* Couleur fonc√©e pour la s√©lection */
            color: #FFFFFF; /* Texte blanc pour le contraste */
            border-color: var(--accent-dark-color);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* Ombre pour la profondeur */
        }
        .quiz-option label {
            transition: all 0.2s ease;
        }
        .quiz-feedback.correct {
            background-color: #D4EDDA; /* Light green */
            color: #155724; /* Dark green */
        }
        .quiz-feedback.incorrect {
            background-color: #F8D7DA; /* Light red */
            color: #721C24; /* Dark red */
        }
        .section-locked {
            opacity: 0.5;
            pointer-events: none;
            filter: grayscale(80%);
        }
        .progress-dot {
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 50%;
            background-color: #B0BEC5; /* Blue-gray 300 */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            color: #FFFFFF;
            transition: background-color 0.3s ease;
        }
        .progress-dot.active {
            background-color: var(--accent-dark-color);
        }
        .progress-dot.completed {
            background-color: #388E3C; /* Dark green */
        }
        .progress-line {
            flex-grow: 1;
            height: 4px;
            background-color: #CFD8DC; /* Blue-gray 200 */
            transition: background-color 0.3s ease;
        }
        .progress-line.completed {
            background-color: #388E3C; /* Dark green */
        }
        .highlight-update {
            background-color: #FFF3CD; /* Light yellow background */
            padding: 0.2em 0.4em;
            border-radius: 0.25rem;
            font-weight: bold;
            color: #856404; /* Dark yellow text */
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-gradient-to-r from-gray-800 to-gray-700 shadow-lg" style="background-image: linear-gradient(to right, var(--header-start-color), var(--header-end-color));">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-white">
            <h1 class="text-3xl font-bold tracking-tight">B1_M5_001_Les diverses cotisations sociales</h1>
            <p class="mt-1 text-gray-200" style="color: var(--header-text-color);">Explorez les diff√©rentes cotisations sociales et leurs objectifs. üìä</p>
        </div>
    </header>

    <main class="py-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            
            <section id="introduction" class="mb-12 bg-white p-6 rounded-xl shadow-lg border-l-4" style="border-color: var(--accent-dark-color);">
                <details open class="cursor-pointer">
                    <summary class="font-bold text-xl text-gray-800 flex items-center py-2">
                        Introduction : Le Financement de la Protection Sociale üõ°Ô∏è
                        <span class="ml-2 text-sm font-normal" style="color: var(--accent-dark-color);">Section active</span>
                    </summary>
                    <div class="mt-4 text-gray-700 space-y-4">
                        <p>Bienvenue dans ce module d√©di√© aux <strong>diverses cotisations sociales</strong>. Les cotisations sociales, calcul√©es notamment sur la base des salaires bruts des salari√©s et vers√©es par l'employeur, ont pour objectif de financer des prestations sociales.</p>
                        <p>D√®s l'ordonnance du 4 octobre 1945 cr√©ant la s√©curit√© sociale, l'objectif affich√© est ¬´ de garantir les travailleurs et leurs familles contre les risques de toute nature susceptibles de r√©duire ou de supprimer leur capacit√© de gain, √† couvrir les charges de maternit√© et les charges de famille qu'ils supportent ¬ª (<a href="https://www.legifrance.gouv.fr/loda/article_lc/LEGIARTI000006509939/" target="_blank" class="text-blue-600 hover:underline">Article 1er de l'Ordonnance du 4 octobre 1945</a>).</p>
                        <p>Ce module vous guidera √† travers :</p>
                        <ul class="list-disc list-inside ml-4">
                            <li>Les <strong>cotisations recouvr√©es par l'URSSAF</strong>.</li>
                            <li>Les <strong>cotisations recouvr√©es par l'AGIRC-ARRCO</strong>.</li>
                            <li>Les <strong>cotisations mutuelles sant√© et pr√©voyance</strong>.</li>
                            <li>Les <strong>contributions patronales annuelles</strong>.</li>
                        </ul>
                        <div class="flex justify-center my-4">
                            <div class="p-6 rounded-lg font-semibold text-center text-2xl" style="background-color: var(--accent-light-color); color: var(--accent-dark-color);">
                                Les cotisations sociales : un pilier de notre syst√®me ! ü§ù
                            </div>
                        </div>
                    </div>
                </details>
                <div class="mini-quiz-area mt-6 p-4 rounded-lg" style="background-color: var(--accent-light-color);" id="mini-quiz-introduction">
                    <h4 class="font-bold text-lg mb-4" style="color: var(--accent-dark-color);">Mini-Quiz : Introduction üìù</h4>
                    <div id="mini-quiz-introduction-container"></div>
                    <button class="validate-section-btn mt-4 py-2 px-4 text-white rounded-lg font-semibold hover:opacity-90 transition hidden" style="background-color: var(--accent-dark-color);" data-section="introduction">Valider la Section ‚úÖ</button>
                </div>
            </section>

            <!-- Global Instruction for Progression -->
            <div class="border-l-4 p-4 mb-8" role="alert" style="background-color: var(--accent-light-color); border-color: var(--accent-dark-color); color: var(--accent-dark-color);">
                <p class="font-bold">Comment √ßa marche ?</p>
                <p>Pour progresser dans ce module, vous devez <strong>valider chaque section</strong>. Lisez attentivement le contenu, puis r√©pondez correctement √† <strong>toutes les questions du mini-quiz</strong> associ√©. Une fois le mini-quiz r√©ussi √† 100%, le bouton "Valider la Section" appara√Ætra, d√©bloquant ainsi la section suivante. Bonne lecture et bon quiz !</p>
            </div>

            <!-- Progress Bar -->
            <div class="flex items-center justify-between mb-12 px-4">
                <div class="progress-dot" id="dot-introduction">1</div>
                <div class="progress-line" id="line-introduction"></div>
                <div class="progress-dot" id="dot-cotisations-urssaf">2</div>
                <div class="progress-line" id="line-cotisations-urssaf"></div>
                <div class="progress-dot" id="dot-cotisations-agirc-arrco">3</div>
                <div class="progress-line" id="line-cotisations-agirc-arrco"></div>
                <div class="progress-dot" id="dot-mutuelle-prevoyance">4</div>
                <div class="progress-line" id="line-mutuelle-prevoyance"></div>
                <div class="progress-dot" id="dot-contributions-patronales-annuelles">5</div>
                <div class="progress-line" id="line-contributions-patronales-annuelles"></div>
                <div class="progress-dot" id="dot-essentiel-cotisations">6</div>
                <div class="progress-line" id="line-essentiel-cotisations"></div>
                <div class="progress-dot" id="dot-final-quiz">üèÅ</div>
            </div>

            <section id="cotisations-urssaf" class="learning-section mb-12 bg-white p-6 rounded-xl shadow-lg border-l-4 border-gray-300 section-locked">
                <details class="cursor-pointer">
                    <summary class="font-bold text-xl text-gray-800 flex items-center py-2">
                        Les Cotisations Recouvr√©es par l'URSSAF üè¶
                        <span class="ml-2 text-gray-500 text-sm font-normal" id="status-cotisations-urssaf">(Verrouill√©e üîí)</span>
                    </summary>
                    <div class="mt-4 text-gray-700 space-y-4">
                        <h3 class="font-semibold text-lg">A. Introduction :</h3>
                        <p>L'URSSAF (Union de Recouvrement des Cotisations de S√©curit√© Sociale et Allocations Familiales) est charg√©e de collecter les cotisations sociales salariales et patronales qui concernent les cotisations de s√©curit√© sociale. Elle les r√©partit ensuite entre les quatre branches de la S√©curit√© Sociale : la maladie, la vieillesse, la famille et les accidents de travail / maladies professionnelles (<a href="https://www.urssaf.fr/portail/home/employeur/calculer-les-cotisations/les-taux-de-cotisations.html" target="_blank" class="text-blue-600 hover:underline">Source : URSSAF</a>).</p>

                        <h3 class="font-semibold text-lg mt-4">B. Cotisation Assurance Maladie, Maternit√©, D√©c√®s :</h3>
                        <p>Finance les indemnit√©s journali√®res (arr√™t maladie, maternit√©), les remboursements de frais m√©dicaux et les pensions d'invalidit√©. Le taux est de <span class="highlight-update">7 % pour les r√©mun√©rations inf√©rieures ou √©gales √† 2,5 fois le SMIC annuel, et de 13 % pour les r√©mun√©rations sup√©rieures √† 2,5 fois le SMIC annuel</span> (<a href="https://www.urssaf.fr/portail/home/employeur/calculer-les-cotisations/les-taux-de-cotisations/lassurance-maladie.html" target="_blank" class="text-blue-600 hover:underline">Source : URSSAF</a>).</p>
                        <div class="overflow-x-auto my-2">
                            <table class="min-w-full bg-white border border-gray-200 rounded-md shadow-sm text-sm">
                                <thead>
                                    <tr class="bg-gray-100">
                                        <th class="py-2 px-4 border-b text-left">Assiette de cotisation</th>
                                        <th class="py-2 px-4 border-b text-left">Part salariale</th>
                                        <th class="py-2 px-4 border-b text-left">Part patronale</th>
                                        <th class="py-2 px-4 border-b text-left">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td class="py-2 px-4 border-b">R√©mun√©ration \le 2,5 SMIC</td><td class="py-2 px-4 border-b">0 %</td><td class="py-2 px-4 border-b">7,00 %</td><td class="py-2 px-4 border-b">7,00 %</td></tr>
                                    <tr><td class="py-2 px-4 border-b">R√©mun√©ration > 2,5 SMIC</td><td class="py-2 px-4 border-b">0 %</td><td class="py-2 px-4 border-b">13,00 %</td><td class="py-2 px-4 border-b">13,00 %</td></tr>
                                </tbody>
                            </table>
                        </div>

                        <h3 class="font-semibold text-lg mt-4">C. Contribution Solidarit√© Autonomie (CSA) :</h3>
                        <p>Cette cotisation est destin√©e √† financer la Caisse nationale de solidarit√© pour l'autonomie des personnes √¢g√©es et handicap√©es. Son taux est de <span class="highlight-update">0,30 % sur le salaire total brut (part patronale)</span>. Elle a √©t√© mise en place suite aux effets de la canicule et finance notamment la "journ√©e de solidarit√©" (<a href="https://www.urssaf.fr/portail/home/employeur/calculer-les-cotisations/les-taux-de-cotisations/la-contribution-solidarite-auto.html" target="_blank" class="text-blue-600 hover:underline">Source : URSSAF</a>).</p>

                        <h3 class="font-semibold text-lg mt-4">D. Cotisation Vieillesse (Plafonn√©e et D√©plafonn√©e) :</h3>
                        <p>Finance le r√©gime de retraite de base (CNAV). Calcul√©e sur deux bases : r√©mun√©ration d√©plafonn√©e (<span class="highlight-update">0,40 % salariale / 2,02 % patronale</span>) et r√©mun√©ration plafonn√©e (<span class="highlight-update">6,90 % salariale / 8,55 % patronale</span>) (<a href="https://www.urssaf.fr/portail/home/employeur/calculer-les-cotisations/les-taux-de-cotisations/lassurance-vieillesse.html" target="_blank" class="text-blue-600 hover:underline">Source : URSSAF</a>).</p>

                        <h3 class="font-semibold text-lg mt-4">E. Cotisation Allocation Familiale :</h3>
                        <p>Finance les prestations vers√©es par la CAF. Le taux r√©duit (<span class="highlight-update">3,45 %</span>) s'applique aux r√©mun√©rations inf√©rieures ou √©gales √† 3,5 fois le SMIC annuel. Au-del√†, le taux est de <span class="highlight-update">5,25 % (3,45 % + 1,80 % compl√©ment)</span> (<a href="https://www.urssaf.fr/portail/home/employeur/calculer-les-cotisations/les-taux-de-cotisations/les-allocations-familiales.html" target="_blank" class="text-blue-600 hover:underline">Source : URSSAF</a>).</p>

                        <h3 class="font-semibold text-lg mt-4">F. Cotisation Accidents du Travail :</h3>
                        <p>Finance les indemnit√©s journali√®res en cas d'accident du travail/maladie professionnelle. Le taux est d√©termin√© par la CARSAT et d√©pend de l'effectif et de l'activit√© de l'entreprise (tarification forfaitaire, mixte ou r√©elle) (<a href="https://www.ameli.fr/entreprise/vos-demarches/cotisations-accidents-travail-maladies-professionnelles/connaitre-taux-cotisation" target="_blank" class="text-blue-600 hover:underline">Source : Ameli.fr</a>).</p>

                        <h3 class="font-semibold text-lg mt-4">G. Cotisation Fonds National d'Aide au Logement (FNAL) :</h3>
                        <p>Finance l'allocation logement. Taux de <span class="highlight-update">0,10 % sur salaire plafonn√© pour entreprises de moins de 50 salari√©s, et 0,50 % sur salaire total brut pour 50 salari√©s et plus</span> (<a href="https://www.urssaf.fr/portail/home/employeur/calculer-les-cotisations/les-taux-de-cotisations/la-contribution-au-fonds-nationa.html" target="_blank" class="text-blue-600 hover:underline">Source : URSSAF</a>).</p>

                        <h3 class="font-semibold text-lg mt-4">H. Versement Mobilit√© (VM) et VM Additionnel :</h3>
                        <p>Participation des employeurs de 11 salari√©s et plus au financement des transports en commun. Taux variable selon la zone g√©ographique, appliqu√© sur le salaire brut (<a href="https://www.urssaf.fr/portail/home/employeur/calculer-les-cotisations/les-taux-de-cotisations/le-versement-mobilite.html" target="_blank" class="text-blue-600 hover:underline">Source : URSSAF</a>).</p>

                        <h3 class="font-semibold text-lg mt-4">I. Forfait Social (8%, 10%, 16%, 20%) :</h3>
                        <p>Cotisation uniquement √† la charge de l'employeur, appliqu√©e sur certains avantages ou r√©mun√©rations non soumis aux cotisations de S√©curit√© Sociale mais soumis √† CSG. Les taux varient selon la nature de l'avantage (<span class="highlight-update">ex: 8 % sur pr√©voyance/mutuelle patronale, 16 % sur Pereco sous conditions, 20 % sur int√©ressement/participation</span>) (<a href="https://www.urssaf.fr/portail/home/employeur/calculer-les-cotisations/les-taux-de-cotisations/le-forfait-social.html" target="_blank" class="text-blue-600 hover:underline">Source : URSSAF</a>).</p>

                        <h3 class="font-semibold text-lg mt-4">M. Contribution au Dialogue Social :</h3>
                        <p>Cotisation patronale (<span class="highlight-update">0,016 %</span>) sur les salaires bruts, destin√©e au financement des organisations syndicales et patronales (<a href="https://www.urssaf.fr/portail/home/employeur/calculer-les-cotisations/les-taux-de-cotisations/la-contribution-au-dialogue-soci.html" target="_blank" class="text-blue-600 hover:underline">Source : URSSAF</a>).</p>

                        <h3 class="font-semibold text-lg mt-4">N. Contribution Sociale G√©n√©ralis√©e (CSG) et Contribution au Remboursement de la Dette Sociale (CRDS) :</h3>
                        <p>Contributions uniquement salariales d√©duites du salaire brut. La CSG finance l'assurance maladie, prestations familiales, etc. La CRDS finance la Caisse d'Amortissement de la Dette Sociale. Elles s'appliquent sur le salaire brut abattu de <span class="highlight-update">1,75 %</span> (dans certaines limites) (<a href="https://www.urssaf.fr/portail/home/employeur/calculer-les-cotisations/les-taux-de-cotisations/la-csg-crds.html" target="_blank" class="text-blue-600 hover:underline">Source : URSSAF</a>).</p>

                        <h3 class="font-semibold text-lg mt-4">O. Cotisation Assurance Ch√¥mage :</h3>
                        <p>Cotisation uniquement patronale (<span class="highlight-update">4,05 %</span> sur salaire brut, limit√© √† 4 fois le PMSS) finan√ßant les indemnit√©s ch√¥mage vers√©es par France Travail. Un syst√®me de "bonus-malus" peut moduler ce taux (<a href="https://www.urssaf.fr/portail/home/employeur/calculer-les-cotisations/les-taux-de-cotisations/lassurance-chomage.html" target="_blank" class="text-blue-600 hover:underline">Source : URSSAF</a>).</p>

                        <h3 class="font-semibold text-lg mt-4">P. Cotisation AGS :</h3>
                        <p>Cotisation purement patronale (<span class="highlight-update">0,25 %</span> sur salaire brut, limit√© √† 4 fois le PMSS) finan√ßant l'assurance de garantie des salaires, qui permet de r√©mun√©rer les salari√©s en cas de d√©faillance de l'entreprise (<a href="https://www.urssaf.fr/portail/home/employeur/calculer-les-cotisations/les-taux-de-cotisations/lags.html" target="_blank" class="text-blue-600 hover:underline">Source : URSSAF</a>).</p>
                    </div>
                </details>
                <div class="mini-quiz-area mt-6 p-4 rounded-lg" style="background-color: var(--accent-light-color);" id="mini-quiz-cotisations-urssaf">
                    <h4 class="font-bold text-lg mb-4" style="color: var(--accent-dark-color);">Mini-Quiz : Cotisations URSSAF üìù</h4>
                    <div id="mini-quiz-cotisations-urssaf-container"></div>
                    <button class="validate-section-btn mt-4 py-2 px-4 text-white rounded-lg font-semibold hover:opacity-90 transition hidden" style="background-color: var(--accent-dark-color);" data-section="cotisations-urssaf">Valider la Section ‚úÖ</button>
                </div>
            </section>

            <section id="cotisations-agirc-arrco" class="learning-section mb-12 bg-white p-6 rounded-xl shadow-lg border-l-4 border-gray-300 section-locked">
                <details class="cursor-pointer">
                    <summary class="font-bold text-xl text-gray-800 flex items-center py-2">
                        Les Cotisations Recouvr√©es par l'AGIRC-ARRCO üëµüë¥
                        <span class="ml-2 text-gray-500 text-sm font-normal" id="status-cotisations-agirc-arrco">(Verrouill√©e üîí)</span>
                    </summary>
                    <div class="mt-4 text-gray-700 space-y-4">
                        <h3 class="font-semibold text-lg">A. Introduction :</h3>
                        <p>L'AGIRC-ARRCO est le r√©gime de retraite compl√©mentaire obligatoire pour tous les salari√©s du secteur priv√© ou agricole (cadres et non-cadres) depuis la fusion des r√©gimes AGIRC et ARRCO en janvier 2019. Ces cotisations financent les pensions de retraite compl√©mentaires (<a href="https://www.agirc-arrco.fr/particuliers/comprendre-ma-retraite/le-regime-agirc-arrco" target="_blank" class="text-blue-600 hover:underline">Source : AGIRC-ARRCO</a>).</p>

                        <h3 class="font-semibold text-lg mt-4">B. Cotisations AGIRC-ARRCO pour les salari√©s non-cadres et cadres :</h3>
                        <p>L'AGIRC-ARRCO pr√©l√®ve trois cotisations principales :</p>
                        <ul class="list-disc list-inside ml-4">
                            <li>La <strong>cotisation retraite compl√©mentaire</strong> (T1 et T2).</li>
                            <li>La <strong>cotisation CEG</strong> (Contribution d'√âquilibre G√©n√©ral) : finance les surco√ªts des d√©parts anticip√©s √† la retraite (CEG T1 et CEG T2).</li>
                            <li>La <strong>cotisation CET</strong> (Contribution d'√âquilibre Technique) : s'applique aux salaires sup√©rieurs au plafond de la s√©curit√© sociale (PMSS).</li>
                        </ul>
                        <div class="overflow-x-auto my-2">
                            <table class="min-w-full bg-white border border-gray-200 rounded-md shadow-sm text-sm">
                                <thead>
                                    <tr class="bg-gray-100">
                                        <th class="py-2 px-4 border-b text-left">Taux de cotisation (inclus pourcentage d'appel 127%)</th>
                                        <th class="py-2 px-4 border-b text-left">√Ä la charge de l'employeur</th>
                                        <th class="py-2 px-4 border-b text-left">√Ä la charge du salari√©</th>
                                        <th class="py-2 px-4 border-b text-left">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td class="py-2 px-4 border-b">T1</td><td class="py-2 px-4 border-b">4,72 %</td><td class="py-2 px-4 border-b">3,15 %</td><td class="py-2 px-4 border-b">7,87 %</td></tr>
                                    <tr><td class="py-2 px-4 border-b">T2</td><td class="py-2 px-4 border-b">12,95 %</td><td class="py-2 px-4 border-b">8,64 %</td><td class="py-2 px-4 border-b">21,59 %</td></tr>
                                    <tr><td class="py-2 px-4 border-b">CEG T1</td><td class="py-2 px-4 border-b">1,29 %</td><td class="py-2 px-4 border-b">0,86 %</td><td class="py-2 px-4 border-b">2,15 %</td></tr>
                                    <tr><td class="py-2 px-4 border-b">CEG T2</td><td class="py-2 px-4 border-b">1,62 %</td><td class="py-2 px-4 border-b">1,08 %</td><td class="py-2 px-4 border-b">2,70 %</td></tr>
                                    <tr><td class="py-2 px-4 border-b">CET</td><td class="py-2 px-4 border-b">0,21 %</td><td class="py-2 px-4 border-b">0,14 %</td><td class="py-2 px-4 border-b">0,35 %</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <p class="italic mt-2">Ces taux sont ceux en vigueur pour 2024 (<a href="https://www.agirc-arrco.fr/employeurs/vos-cotisations/les-taux-de-cotisation-agirc-arrco" target="_blank" class="text-blue-600 hover:underline">Source : AGIRC-ARRCO</a>).</p>

                        <h3 class="font-semibold text-lg mt-4">C. Cotisations AGIRC-ARRCO pour les salari√©s cadres (en plus) :</h3>
                        <ul class="list-disc list-inside ml-4">
                            <li>La <strong>cotisation pr√©voyance Assurance d√©c√®s cadre</strong> (<a href="https://www.agirc-arrco.fr/particuliers/comprendre-ma-retraite/les-garanties-prevoyance-des-cadres" target="_blank" class="text-blue-600 hover:underline">Article 4 et 4 bis de la convention collective nationale de retraite et de pr√©voyance des cadres du 14 mars 1947</a>) : obligatoire, minimum de <span class="highlight-update">1,50 % sur le salaire plafonn√© (part patronale uniquement)</span>. Finance un capital d√©c√®s pour les ayants droit.</li>
                            <li>La <strong>cotisation APEC</strong> (Association Pour l'Emploi des Cadres) : cotisation mensuelle (<span class="highlight-update">0,036 % employeur / 0,024 % salari√©</span>) pr√©lev√©e sur les salaires des cadres, limit√©e √† 4 fois le PMSS (<a href="https://www.apec.fr/recruteur/recruter-cadres/cotisations-apec.html" target="_blank" class="text-blue-600 hover:underline">Source : APEC</a>).</li>
                        </ul>
                    </div>
                </details>
                <div class="mini-quiz-area mt-6 p-4 rounded-lg" style="background-color: var(--accent-light-color);" id="mini-quiz-cotisations-agirc-arrco">
                    <h4 class="font-bold text-lg mb-4" style="color: var(--accent-dark-color);">Mini-Quiz : Cotisations AGIRC-ARRCO üìù</h4>
                    <div id="mini-quiz-cotisations-agirc-arrco-container"></div>
                    <button class="validate-section-btn mt-4 py-2 px-4 text-white rounded-lg font-semibold hover:opacity-90 transition hidden" style="background-color: var(--accent-dark-color);" data-section="cotisations-agirc-arrco">Valider la Section ‚úÖ</button>
                </div>
            </section>

            <section id="mutuelle-prevoyance" class="learning-section mb-12 bg-white p-6 rounded-xl shadow-lg border-l-4 border-gray-300 section-locked">
                <details class="cursor-pointer">
                    <summary class="font-bold text-xl text-gray-800 flex items-center py-2">
                        Les Cotisations Mutuelle Sant√© et Pr√©voyance üè•
                        <span class="ml-2 text-gray-500 text-sm font-normal" id="status-mutuelle-prevoyance">(Verrouill√©e üîí)</span>
                    </summary>
                    <div class="mt-4 text-gray-700 space-y-4">
                        <h3 class="font-semibold text-lg">A. La Mutuelle Sant√© Obligatoire :</h3>
                        <p>Les entreprises sont oblig√©es d'instaurer un contrat collectif de mutuelle sant√© pour leurs salari√©s. Cette couverture compl√®te les remboursements de la S√©curit√© sociale.</p>
                        <p>Conditions √† respecter (<a href="https://www.service-public.fr/professionnels-entreprises/vosdroits/F33754" target="_blank" class="text-blue-600 hover:underline">Source : Service-Public.fr</a>) :</p>
                        <ul class="list-disc list-inside ml-4">
                            <li>Participation financi√®re de l'employeur d'au moins <span class="highlight-update">50 % de la cotisation</span>.</li>
                            <li>Respect d'un socle de garanties minimales (panier de soins minimum).</li>
                            <li>Contrat obligatoire pour tous les salari√©s, sauf cas de dispense (d√©j√† couvert, CDD de moins de 3 mois, temps tr√®s partiel, etc.).</li>
                        </ul>
                        <p class="italic">La cotisation patronale de participation √† la mutuelle sant√© obligatoire est soumise √† la CSG/CRDS ainsi qu'au forfait social si l'effectif de l'entreprise est de 11 salari√©s et plus. Elle est √©galement imposable pour le salari√©.</p>

                        <h3 class="font-semibold text-lg mt-4">B. Le Versement Sant√© (ou ch√®que sant√©) :</h3>
                        <p>Lorsque le salari√© est dispens√© d'adh√©rer √† la mutuelle collective (CDD < 3 mois ou temps tr√®s partiel), l'employeur doit proposer le Versement Sant√©. C'est une aide financi√®re pour la mutuelle personnelle du salari√© (<a href="https://www.urssaf.fr/portail/home/employeur/calculer-les-cotisations/les-elements-de-remuneration/le-versement-sante.html" target="_blank" class="text-blue-600 hover:underline">Source : URSSAF</a>).</p>
                        <p>Conditions pour en b√©n√©ficier :</p>
                        <ul class="list-disc list-inside ml-4">
                            <li>Justifier d'une couverture responsable.</li>
                            <li>Ne pas √™tre d√©j√† b√©n√©ficiaire d'une couverture collective ou financ√©e par une collectivit√© publique, ni de la CSS.</li>
                        </ul>
                        <p>Le montant est le montant de r√©f√©rence (contribution mensuelle employeur √† la mutuelle) multipli√© par un coefficient (<span class="highlight-update">105 % pour les salari√©s en CDI, 125 % pour les salari√©s en CDD ou en contrat de mission</span>). Il ne peut √™tre inf√©rieur √† un minimum l√©gal (<span class="highlight-update">20,75 ‚Ç¨ en 2024</span>) (<a href="https://www.urssaf.fr/portail/home/employeur/calculer-les-cotisations/les-elements-de-remuneration/le-versement-sante.html" target="_blank" class="text-blue-600 hover:underline">Source : URSSAF</a>).</p>
                        <p class="italic">Les sommes vers√©es au titre du versement sant√© sont exon√©r√©es de cotisations sociales mais assujetties en totalit√© √† CSG/CRDS ainsi qu'au forfait social dans les entreprises de 11 salari√©s et plus.</p>

                        <h3 class="font-semibold text-lg mt-4">C. La Pr√©voyance Compl√©mentaire :</h3>
                        <p>Les employeurs peuvent mettre en place des contrats de pr√©voyance compl√©mentaire collective non obligatoires (sauf si impos√© par convention collective) pour couvrir et compl√©ter les revenus des salari√©s en cas d'accidents de la vie (arr√™ts de travail, invalidit√©, incapacit√© permanente, d√©c√®s) (<a href="https://www.service-public.fr/particuliers/vosdroits/F31593" target="_blank" class="text-blue-600 hover:underline">Source : Service-Public.fr</a>).</p>
                        <p class="italic">La participation patronale √† la pr√©voyance compl√©mentaire est soumise √† la CSG/CRDS ainsi qu'au forfait social si l'effectif de l'entreprise est de 11 salari√©s et plus.</p>
                    </div>
                </details>
                <div class="mini-quiz-area mt-6 p-4 rounded-lg" style="background-color: var(--accent-light-color);" id="mini-quiz-mutuelle-prevoyance">
                    <h4 class="font-bold text-lg mb-4" style="color: var(--accent-dark-color);">Mini-Quiz : Mutuelle et Pr√©voyance üìù</h4>
                    <div id="mini-quiz-mutuelle-prevoyance-container"></div>
                    <button class="validate-section-btn mt-4 py-2 px-4 text-white rounded-lg font-semibold hover:opacity-90 transition hidden" style="background-color: var(--accent-dark-color);" data-section="mutuelle-prevoyance">Valider la Section ‚úÖ</button>
                </div>
            </section>

            <section id="contributions-patronales-annuelles" class="learning-section mb-12 bg-white p-6 rounded-xl shadow-lg border-l-4 border-gray-300 section-locked">
                <details class="cursor-pointer">
                    <summary class="font-bold text-xl text-gray-800 flex items-center py-2">
                        Les Contributions Patronales Annuelles üìÖ
                        <span class="ml-2 text-gray-500 text-sm font-normal" id="status-contributions-patronales-annuelles">(Verrouill√©e üîí)</span>
                    </summary>
                    <div class="mt-4 text-gray-700 space-y-4">
                        <p>Les employeurs concourent au d√©veloppement de la formation professionnelle et de l'apprentissage ainsi qu'√† d'autres dispositifs par le versement de diverses contributions.</p>

                        <h3 class="font-semibold text-lg mt-4">A. Contributions de la Formation Professionnelle et de l'Apprentissage :</h3>
                        <p>Regroup√©es sous la <strong>Contribution Unique √† la Formation Professionnelle et √† l'Alternance (CUFPA)</strong>, elles comprennent :</p>
                        <ul class="list-disc list-inside ml-4">
                            <li>La <strong>Contribution √† la Formation Professionnelle (CFP)</strong> : finance la formation continue des salari√©s et demandeurs d'emploi. Taux variable selon la taille de l'entreprise (<span class="highlight-update">ex: 0,55 % pour moins de 11 salari√©s, 1 % pour 11 salari√©s et plus</span>) (<a href="https://www.urssaf.fr/portail/home/employeur/calculer-les-cotisations/les-taux-de-cotisations/la-contribution-a-la-formation-p.html" target="_blank" class="text-blue-600 hover:underline">Source : URSSAF</a>).</li>
                            <li>La <strong>Contribution CPF-CDD</strong> : due en cas d'emploi de salari√©s en CDD (<span class="highlight-update">1 % de la masse salariale</span>), sauf exceptions (contrats aid√©s, saisonniers) (<a href="https://www.service-public.fr/professionnels-entreprises/vosdroits/F32085" target="_blank" class="text-blue-600 hover:underline">Source : Service-Public.fr</a>).</li>
                            <li>La <strong>Taxe d'Apprentissage (TA)</strong> : imp√¥t finan√ßant l'apprentissage et les formations technologiques/professionnelles (<span class="highlight-update">0,68 % de la masse salariale annuelle brute, sauf Alsace-Moselle o√π c'est 0,44 %</span>) (<a href="https://www.urssaf.fr/portail/home/employeur/calculer-les-cotisations/les-taux-de-cotisations/la-taxe-dapprentissage.html" target="_blank" class="text-blue-600 hover:underline">Source : URSSAF</a>).</li>
                            <li>La <strong>Contribution Suppl√©mentaire √† l'Apprentissage (CSA)</strong> : due par les entreprises de 250 salari√©s et plus qui emploient moins de 5% d'alternants. Le taux varie selon le pourcentage d'alternants (<a href="https://www.urssaf.fr/portail/home/employeur/calculer-les-cotisations/les-taux-de-cotisations/la-contribution-supplementaire-a-l.html" target="_blank" class="text-blue-600 hover:underline">Source : URSSAF</a>).</li>
                        </ul>

                        <h3 class="font-semibold text-lg mt-4">B. Participation des Employeurs √† l'Effort de Construction (PEEC) :</h3>
                        <p>Aussi appel√©e ¬´ dispositif 1% logement ¬ª, due par les employeurs d'au moins <span class="highlight-update">50 salari√©s</span> assujettis √† la taxe sur les salaires. Taux de <span class="highlight-update">0,45 % sur les r√©mun√©rations brutes annuelles</span>. Elle finance des investissements pour le logement des travailleurs (<a href="https://www.urssaf.fr/portail/home/employeur/calculer-les-cotisations/les-taux-de-cotisations/la-participation-des-employeurs-a.html" target="_blank" class="text-blue-600 hover:underline">Source : URSSAF</a>).</p>

                        <h3 class="font-semibold text-lg mt-4">C. Contribution annuelle √† l'Obligation d'Emploi des Travailleurs Handicap√©s (OETH) :</h3>
                        <p>Due par les entreprises de <span class="highlight-update">plus de 20 salari√©s</span> qui ne respectent pas l'obligation d'emploi de <span class="highlight-update">6 % de travailleurs handicap√©s</span>. Elle est revers√©e √† l'Agefiph (<a href="https://www.urssaf.fr/portail/home/employeur/calculer-les-cotisations/les-taux-de-cotisations/contribution-annuelle-oeth.html" target="_blank" class="text-blue-600 hover:underline">Source : URSSAF</a>).</p>
                    </div>
                </details>
                <div class="mini-quiz-area mt-6 p-4 rounded-lg" style="background-color: var(--accent-light-color);" id="mini-quiz-contributions-patronales-annuelles">
                    <h4 class="font-bold text-lg mb-4" style="color: var(--accent-dark-color);">Mini-Quiz : Contributions Patronales Annuelles üìù</h4>
                    <div id="mini-quiz-contributions-patronales-annuelles-container"></div>
                    <button class="validate-section-btn mt-4 py-2 px-4 text-white rounded-lg font-semibold hover:opacity-90 transition hidden" style="background-color: var(--accent-dark-color);" data-section="contributions-patronales-annuelles">Valider la Section ‚úÖ</button>
                </div>
            </section>

            <section id="essentiel-cotisations" class="learning-section mb-12 bg-white p-6 rounded-xl shadow-lg border-l-4 border-gray-300 section-locked">
                <details class="cursor-pointer">
                    <summary class="font-bold text-xl text-gray-800 flex items-center py-2">
                        Essentiel : Les Points Cl√©s des Cotisations Sociales ‚úîÔ∏è
                        <span class="ml-2 text-gray-500 text-sm font-normal" id="status-essentiel-cotisations">(Verrouill√©e üîí)</span>
                    </summary>
                    <div class="mt-4 text-gray-700 space-y-4">
                        <h3 class="font-semibold text-lg">Objectif des cotisations sociales :</h3>
                        <ul class="list-disc list-inside ml-4">
                            <li>Financer les prestations sociales et garantir la protection des travailleurs et de leurs familles.</li>
                        </ul>

                        <h3 class="font-semibold text-lg mt-4">Cotisations URSSAF :</h3>
                        <ul class="list-disc list-inside ml-4">
                            <li>Collecte les cotisations de s√©curit√© sociale (maladie, vieillesse, famille, accidents du travail).</li>
                            <li>Inclut la CSG/CRDS (salariales), l'assurance ch√¥mage (patronale), l'AGS (patronale), le forfait social (patronal sur certains avantages), etc.</li>
                            <li>Les taux varient souvent en fonction du salaire (ex: maladie, allocations familiales) et de l'effectif de l'entreprise.</li>
                        </ul>

                        <h3 class="font-semibold text-lg mt-4">Cotisations AGIRC-ARRCO :</h3>
                        <ul class="list-disc list-inside ml-4">
                            <li>Financent la retraite compl√©mentaire obligatoire pour tous les salari√©s du priv√©.</li>
                            <li>Comprend la retraite compl√©mentaire (T1, T2), la CEG et la CET.</li>
                            <li>Les cadres ont des cotisations sp√©cifiques (pr√©voyance d√©c√®s cadre, APEC).</li>
                        </ul>

                        <h3 class="font-semibold text-lg mt-4">Mutuelle Sant√© et Pr√©voyance :</h3>
                        <ul class="list-disc list-inside ml-4">
                            <li>Mutuelle sant√© collective obligatoire : participation employeur $\ge 50\%$, panier de soins minimum, cas de dispense.</li>
                            <li>Versement Sant√© : aide pour mutuelle personnelle si salari√© dispens√© de la collective.</li>
                            <li>Pr√©voyance compl√©mentaire : couvre arr√™ts de travail, invalidit√©, d√©c√®s (peut √™tre obligatoire selon la convention collective).</li>
                            <li>La part patronale de mutuelle/pr√©voyance est souvent soumise √† CSG/CRDS et forfait social.</li>
                        </ul>

                        <h3 class="font-semibold text-lg mt-4">Contributions Patronales Annuelles :</h3>
                        <ul class="list-disc list-inside ml-4">
                            <li><strong>CUFPA</strong> (CFP, Taxe d'Apprentissage, CPF-CDD) : finance la formation professionnelle et l'apprentissage.</li>
                            <li><strong>PEEC</strong> (1% logement) : finance le logement des travailleurs (entreprises $\ge 50$ salari√©s).</li>
                            <li><strong>OETH</strong> : contribution pour l'emploi des travailleurs handicap√©s (entreprises $> 20$ salari√©s ne respectant pas le quota).</li>
                        </ul>
                    </div>
                </details>
                <div class="mini-quiz-area mt-6 p-4 rounded-lg" style="background-color: var(--accent-light-color);" id="mini-quiz-essentiel-cotisations">
                    <h4 class="font-bold text-lg mb-4" style="color: var(--accent-dark-color);">Mini-Quiz : Essentiel Cotisations üìù</h4>
                    <div id="mini-quiz-essentiel-cotisations-container"></div>
                    <button class="validate-section-btn mt-4 py-2 px-4 text-white rounded-lg font-semibold hover:opacity-90 transition hidden" style="background-color: var(--accent-dark-color);" data-section="essentiel-cotisations">Valider la Section ‚úÖ</button>
                </div>
            </section>

            <section id="final-quiz-section" class="mt-16 bg-white p-6 rounded-xl shadow-lg border-l-4 border-gray-300 section-locked">
                <h2 class="text-2xl font-bold text-gray-800 text-center mb-8">Quiz Final sur les Diverses Cotisations Sociales üéì</h2>
                <p class="mt-2 text-lg text-gray-600 text-center mb-8" id="final-quiz-intro">Mettez vos connaissances √† l'√©preuve ! R√©pondez aux questions et d√©couvrez les <strong>justifications d√©taill√©es</strong> pour chaque bonne r√©ponse, comme un vrai expert. üí°</p>
                
                <div id="quiz-container" class="hidden">
                    <h3 id="quiz-question" class="text-xl font-semibold text-gray-800 mb-4"></h3>
                    <div id="quiz-options" class="space-y-3 mb-6">
                        <!-- Options will be dynamically loaded here -->
                    </div>
                    <div id="quiz-feedback" class="p-4 rounded-lg text-sm hidden">
                        <!-- Feedback will be displayed here -->
                    </div>
                    <div class="mt-4 p-4 bg-gray-50 rounded-lg text-sm text-gray-700 hidden">
                        <h4 class="font-bold mb-2">Explication D√©taill√©e üßê</h4>
                        <p id="explanation-text"></p>
                    </div>
                    <div class="mt-6 flex justify-between">
                        <button id="submit-answer" class="py-2 px-4 text-white rounded-lg font-semibold hover:opacity-90 transition" style="background-color: var(--accent-dark-color);">Valider la r√©ponse ‚úÖ</button>
                        <button id="next-question" class="py-2 px-4 bg-gray-300 text-gray-800 rounded-lg font-semibold hover:bg-gray-400 transition hidden">Question suivante ‚û°Ô∏è</button>
                    </div>
                </div>
                <div id="start-final-quiz-container" class="text-center">
                    <button id="start-final-quiz-btn" class="py-3 px-6 text-white rounded-lg font-bold text-lg hover:opacity-90 transition" style="background-color: var(--accent-dark-color);">D√©marrer le Quiz Final ! üöÄ</button>
                </div>
            </section>

        </div>
    </main>

    <footer class="bg-gradient-to-r from-gray-800 to-gray-700 mt-16" style="background-image: linear-gradient(to right, var(--header-start-color), var(--header-end-color));">
        <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm text-gray-200" style="color: var(--header-text-color);">
            <p>Cr√©√© par Mathilde Martine PAISLEY L'Enervante, Enervanteüí™üèæ</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Function to generate random colors
            function getRandomColor() {
                const colors = [
                    { headerStart: '#4CAF50', headerEnd: '#8BC34A', headerText: '#DCEDC8', accentDark: '#4CAF50', accentLight: '#E8F5E9' }, // Green
                    { headerStart: '#2196F3', headerEnd: '#03A9F4', headerText: '#BBDEFB', accentDark: '#2196F3', accentLight: '#E3F2FD' }, // Blue
                    { headerStart: '#FF9800', headerEnd: '#FFB300', headerText: '#FFECB3', accentDark: '#FF9800', accentLight: '#FFF3E0' }, // Orange
                    { headerStart: '#9C27B0', headerEnd: '#E040FB', headerText: '#F3E5F5', accentDark: '#9C27B0', accentLight: '#FCE4EC' }, // Purple
                    { headerStart: '#009688', headerEnd: '#00BCD4', headerText: '#B2EBF2', accentDark: '#009688', accentLight: '#E0F2F7' }, // Teal
                    { headerStart: '#F44336', headerEnd: '#E53935', headerText: '#FFCDD2', accentDark: '#F44336', accentLight: '#FFEBEE' }, // Red
                    { headerStart: '#607D8B', headerEnd: '#78909C', headerText: '#CFD8DC', accentDark: '#607D8B', accentLight: '#ECEFF1' }  // Blue-gray
                ];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            const chosenColors = getRandomColor();
            document.documentElement.style.setProperty('--header-start-color', chosenColors.headerStart);
            document.documentElement.style.setProperty('--header-end-color', chosenColors.headerEnd);
            document.documentElement.style.setProperty('--header-text-color', chosenColors.headerText);
            document.documentElement.style.setProperty('--accent-dark-color', chosenColors.accentDark);
            document.documentElement.style.setProperty('--accent-light-color', chosenColors.accentLight);


            // --- Global Quiz Data ---
            const allQuizQuestions = {
                "introduction": [
                    {
                        question: "Quel est l'objectif principal de ce module de formation ?",
                        options: [
                            "Apprendre √† coder en HTML.",
                            "Comprendre les diverses cotisations sociales et leurs objectifs.",
                            "R√©viser les r√®gles de calcul num√©rique.",
                            "Analyser des donn√©es financi√®res complexes."
                        ],
                        correctAnswer: 1,
                        explanation: "L'objectif principal de ce module est de vous aider √† <strong>comprendre les diverses cotisations sociales et leurs objectifs</strong> en entreprise."
                    },
                    {
                        question: "Vrai ou Faux : Les cotisations sociales sont uniquement √† la charge des salari√©s.",
                        options: [
                            "Vrai.",
                            "Faux."
                        ],
                        correctAnswer: 1,
                        explanation: "<strong>Faux</strong>. Les cotisations sociales sont √† la charge des salari√©s (cotisations salariales) et des employeurs (cotisations patronales)."
                    }
                ],
                "cotisations-urssaf": [
                    {
                        question: "Quel organisme est principalement charg√© de collecter les cotisations de s√©curit√© sociale ?",
                        options: [
                            "L'AGIRC-ARRCO.",
                            "La CARSAT.",
                            "L'URSSAF.",
                            "France Travail."
                        ],
                        correctAnswer: 2,
                        explanation: "L'<strong>URSSAF</strong> (Union de Recouvrement des Cotisations de S√©curit√© Sociale et Allocations Familiales) est charg√©e de collecter les cotisations sociales salariales et patronales qui concernent les cotisations de s√©curit√© sociale."
                    },
                    {
                        question: "Parmi les cotisations suivantes, laquelle est principalement collect√©e par l'URSSAF ?",
                        options: [
                            "Cotisation d'assurance vieillesse.",
                            "Cotisation de pr√©voyance compl√©mentaire.",
                            "Cotisation AGIRC-ARRCO.",
                            "Mutuelle sant√© obligatoire."
                        ],
                        correctAnswer: 0,
                        explanation: "L'URSSAF collecte plusieurs cotisations sociales, notamment l'<strong>assurance vieillesse</strong> pour la retraite de base, la cotisation familiale, ou la cotisation ch√¥mage. La cotisation de pr√©voyance est quant √† elle g√©n√©ralement collect√©e par la caisse de pr√©voyance."
                    },
                    {
                        question: "Le taux de la cotisation d'allocation familiale est-il toujours de 3,45 % ?",
                        options: [
                            "Vrai.",
                            "Faux."
                        ],
                        correctAnswer: 1,
                        explanation: "<strong>Faux</strong>. Le taux de la cotisation d'allocation familiale d√©pend du salaire du collaborateur. Il est r√©duit √† 3,45 % lorsque sa r√©mun√©ration brute est inf√©rieure ou √©gale √† 3,5 fois le SMIC annuel. Au-del√†, une majoration de 1,80 % s'applique, portant le taux √† 5,25 %."
                    },
                    {
                        question: "Le forfait social au taux de 20 % s'applique principalement √† :",
                        options: [
                            "L'int√©ressement et la participation des salari√©s.",
                            "Les heures suppl√©mentaires.",
                            "Les indemnit√©s de rupture conventionnelle.",
                            "Les heures compl√©mentaires."
                        ],
                        correctAnswer: 0,
                        explanation: "Le forfait social au taux de 20 % s'applique principalement aux sommes vers√©es au titre de l'<strong>√©pargne salariale, comme l'int√©ressement et la participation</strong>. Les heures suppl√©mentaires ou compl√©mentaires sont exon√©r√©es de forfait social. Les indemnit√©s de rupture conventionnelle ont un r√©gime sp√©cifique depuis le 1er septembre 2023 et ne sont plus soumises au forfait social au taux de 20 %."
                    },
                    {
                        question: "Vrai ou Faux : La Contribution Sociale G√©n√©ralis√©e (CSG) est une contribution uniquement patronale.",
                        options: [
                            "Vrai.",
                            "Faux."
                        ],
                        correctAnswer: 1,
                        explanation: "<strong>Faux</strong>. La CSG est une contribution <strong>uniquement salariale</strong>, d√©duite du salaire brut du salari√©."
                    }
                ],
                "cotisations-agirc-arrco": [
                    {
                        question: "Quel r√©gime de retraite compl√©mentaire est obligatoire pour les salari√©s du secteur priv√© ?",
                        options: [
                            "La CNAV.",
                            "L'AGIRC-ARRCO.",
                            "Le fonds de solidarit√© vieillesse.",
                            "La CARSAT."
                        ],
                        correctAnswer: 1,
                        explanation: "L'<strong>AGIRC-ARRCO</strong> est le r√©gime de retraite compl√©mentaire obligatoire pour tous les salari√©s du secteur priv√© ou agricole."
                    },
                    {
                        question: "Quelle cotisation AGIRC-ARRCO s'applique aux salaires sup√©rieurs au plafond de la s√©curit√© sociale (PMSS) ?",
                        options: [
                            "La cotisation T1.",
                            "La cotisation CEG.",
                            "La cotisation CET.",
                            "La cotisation APEC."
                        ],
                        correctAnswer: 2,
                        explanation: "La <strong>cotisation CET</strong> (Contribution d'√âquilibre Technique) s'applique √† tous les salari√©s dont le salaire est sup√©rieur au plafond de la s√©curit√© sociale."
                    },
                    {
                        question: "Vrai ou Faux : La cotisation pr√©voyance Assurance d√©c√®s cadre est une cotisation salariale.",
                        options: [
                            "Vrai.",
                            "Faux."
                        ],
                        correctAnswer: 1,
                        explanation: "<strong>Faux</strong>. La cotisation pr√©voyance Assurance d√©c√®s cadre (article 4 et 4 bis de la convention collective nationale de retraite et de pr√©voyance des cadres du 14 mars 1947) est uniquement une <strong>cotisation patronale</strong>."
                    },
                    {
                        question: "Quelle cotisation AGIRC-ARRCO finance les surco√ªts des d√©parts anticip√©s √† la retraite ?",
                        options: [
                            "La cotisation retraite compl√©mentaire.",
                            "La cotisation CEG.",
                            "La cotisation CET.",
                            "La cotisation APEC."
                        ],
                        correctAnswer: 1,
                        explanation: "La <strong>cotisation CEG</strong> (Contribution d'√âquilibre G√©n√©ral) finance les surco√ªts des d√©parts anticip√©s √† la retraite."
                    },
                    {
                        question: "L'APEC est financ√©e par des cotisations pr√©lev√©es sur les salaires des :",
                        options: [
                            "Salari√©s non-cadres.",
                            "Salari√©s cadres.",
                            "Tous les salari√©s.",
                            "Uniquement les dirigeants."
                        ],
                        correctAnswer: 1,
                        explanation: "La cotisation APEC est pr√©lev√©e sur les salaires des <strong>salari√©s cadres</strong> inscrits au r√©gime de pr√©voyance et de retraite."
                    }
                ],
                "mutuelle-prevoyance": [
                    {
                        question: "Quelle est la participation minimale de l'employeur √† la cotisation de mutuelle sant√© obligatoire ?",
                        options: [
                            "25%",
                            "40%",
                            "50%",
                            "100%"
                        ],
                        correctAnswer: 2,
                        explanation: "L'article L911-7 du Code de la S√©curit√© sociale pr√©voit que la participation financi√®re de l'employeur √† la mutuelle sant√© obligatoire doit √™tre au moins √©gale √† <strong>50%</strong> de la cotisation."
                    },
                    {
                        question: "Le Versement Sant√© (ou ch√®que sant√©) est propos√© au salari√© lorsque :",
                        options: [
                            "Il est en CDI √† temps plein.",
                            "Il est d√©j√† couvert par la mutuelle collective.",
                            "Il est dispens√© d'adh√©rer √† la mutuelle collective (ex: CDD < 3 mois).",
                            "L'employeur ne propose pas de mutuelle."
                        ],
                        correctAnswer: 2,
                        explanation: "Le Versement Sant√© est une aide financi√®re pour la mutuelle personnelle du salari√© lorsqu'il est <strong>dispens√© d'adh√©rer √† la mutuelle collective</strong> (ex: CDD de moins de 3 mois ou temps tr√®s partiel)."
                    },
                    {
                        question: "Vrai ou Faux : La participation patronale √† la mutuelle sant√© obligatoire est imposable pour le salari√©.",
                        options: [
                            "Vrai.",
                            "Faux."
                        ],
                        correctAnswer: 0,
                        explanation: "<strong>Vrai</strong>. La participation patronale √† la mutuelle est ajout√©e au salaire net imposable du salari√© pour le calcul de l'imp√¥t sur le revenu."
                    },
                    {
                        question: "Les contrats de pr√©voyance compl√©mentaire collective sont-ils toujours obligatoires pour les employeurs ?",
                        options: [
                            "Oui, toujours.",
                            "Non, sauf si impos√© par convention collective.",
                            "Uniquement pour les cadres.",
                            "Uniquement pour les entreprises de plus de 50 salari√©s."
                        ],
                        correctAnswer: 1,
                        explanation: "Les employeurs peuvent mettre en place des contrats de pr√©voyance compl√©mentaire collective non obligatoires, <strong>sauf si impos√© par convention collective</strong>."
                    },
                    {
                        question: "Le montant de r√©f√©rence du Versement Sant√© ne peut √™tre inf√©rieur √† un minimum l√©gal. Quel √©tait ce minimum en 2024 ?",
                        options: [
                            "10,00 ‚Ç¨",
                            "15,50 ‚Ç¨",
                            "20,75 ‚Ç¨",
                            "25,00 ‚Ç¨"
                        ],
                        correctAnswer: 2,
                        explanation: "Le montant de r√©f√©rence du Versement Sant√© ne peut √™tre inf√©rieur √† un minimum l√©gal, qui √©tait de <strong>20,75 ‚Ç¨ en 2024</strong>."
                    }
                ],
                "contributions-patronales-annuelles": [
                    {
                        question: "Quelle contribution regroupe la Contribution √† la Formation Professionnelle (CFP) et la Taxe d'Apprentissage (TA) ?",
                        options: [
                            "La PEEC.",
                            "L'OETH.",
                            "La CUFPA.",
                            "La CSA."
                        ],
                        correctAnswer: 2,
                        explanation: "La <strong>Contribution Unique √† la Formation Professionnelle et √† l'Alternance (CUFPA)</strong> regroupe la CFP et la Taxe d'Apprentissage."
                    },
                    {
                        question: "La Participation des Employeurs √† l'Effort de Construction (PEEC) est due par les employeurs d'au moins combien de salari√©s ?",
                        options: [
                            "11 salari√©s.",
                            "20 salari√©s.",
                            "50 salari√©s.",
                            "250 salari√©s."
                        ],
                        correctAnswer: 2,
                        explanation: "La <strong>PEEC</strong> (dispositif 1% logement) est due par les employeurs d'au moins <strong>50 salari√©s</strong>, tous √©tablissements confondus."
                    },
                    {
                        question: "Vrai ou Faux : La Taxe d'Apprentissage est une cotisation sociale.",
                        options: [
                            "Vrai.",
                            "Faux."
                        ],
                        correctAnswer: 1,
                        explanation: "<strong>Faux</strong>. La Taxe d'Apprentissage est un <strong>imp√¥t</strong> (et non une cotisation sociale), d√ª par les entreprises afin de financer l'apprentissage ainsi que les formations technologiques et professionnelles."
                    },
                    {
                        question: "Quelle contribution est due par les entreprises de plus de 20 salari√©s qui ne respectent pas l'obligation d'emploi de 6% de travailleurs handicap√©s ?",
                        options: [
                            "La CFP.",
                            "La PEEC.",
                            "La CSA.",
                            "L'OETH."
                        ],
                        correctAnswer: 3,
                        explanation: "C'est la <strong>Contribution annuelle √† l'Obligation d'Emploi des Travailleurs Handicap√©s (OETH)</strong> qui est due par ces entreprises."
                    },
                    {
                        question: "Le taux de la Contribution √† la Formation Professionnelle (CFP) pour une entreprise de moins de 11 salari√©s est de :",
                        options: [
                            "0,55%",
                            "1%",
                            "1,30%",
                            "2%"
                        ],
                        correctAnswer: 0,
                        explanation: "Le taux de la CFP pour une entreprise de moins de 11 salari√©s est de <strong>0,55%</strong>."
                    }
                ],
                "essentiel-cotisations": [
                    {
                        question: "Les cotisations sociales ont pour objectif de financer :",
                        options: [
                            "Uniquement les salaires des dirigeants.",
                            "Les prestations sociales.",
                            "Les imp√¥ts des entreprises.",
                            "Les dividendes des actionnaires."
                        ],
                        correctAnswer: 1,
                        explanation: "Les cotisations sociales ont pour objectif de financer les <strong>prestations sociales</strong>, garantissant la protection des travailleurs et de leurs familles."
                    },
                    {
                        question: "Vrai ou Faux : Le forfait social est une cotisation uniquement √† la charge des salari√©s.",
                        options: [
                            "Vrai.",
                            "Faux."
                        ],
                        correctAnswer: 1,
                        explanation: "<strong>Faux</strong>. Le forfait social est une cotisation <strong>uniquement √† la charge de l'employeur</strong> (charge patronale)."
                    },
                    {
                        question: "Quel est l'organisme qui collecte les cotisations de s√©curit√© sociale (maladie, vieillesse, famille, accidents du travail) ?",
                        options: [
                            "L'AGIRC-ARRCO.",
                            "La CAF.",
                            "L'URSSAF.",
                            "France Travail."
                        ],
                        correctAnswer: 2,
                        explanation: "L'<strong>URSSAF</strong> est l'organisme charg√© de collecter les cotisations de s√©curit√© sociale."
                    },
                    {
                        question: "Les cotisations AGIRC-ARRCO financent :",
                        options: [
                            "L'assurance maladie.",
                            "Les allocations familiales.",
                            "La retraite compl√©mentaire obligatoire.",
                            "L'assurance ch√¥mage."
                        ],
                        correctAnswer: 2,
                        explanation: "Les cotisations <strong>AGIRC-ARRCO</strong> financent la <strong>retraite compl√©mentaire obligatoire</strong> pour tous les salari√©s du secteur priv√©."
                    },
                    {
                        question: "La CUFPA, la PEEC et l'OETH sont des exemples de :",
                        options: [
                            "Cotisations salariales.",
                            "Contributions patronales annuelles.",
                            "Prestations sociales.",
                            "R√©ductions de cotisations."
                        ],
                        correctAnswer: 1,
                        explanation: "La CUFPA, la PEEC et l'OETH sont des exemples de <strong>contributions patronales annuelles</strong>, concourant au financement de la formation, du logement ou de l'emploi des travailleurs handicap√©s."
                    }
                ],
                "final-quiz": [ 
                    {
                        question: "Quel est l'objectif principal des cotisations sociales ?",
                        options: [
                            "Augmenter le b√©n√©fice des entreprises.",
                            "Financer les prestations sociales.",
                            "R√©duire le salaire net des employ√©s.",
                            "Simplifier la gestion de la paie."
                        ],
                        correctAnswer: 1,
                        explanation: "Les cotisations sociales ont pour objectif de <strong>financer les prestations sociales</strong>, assurant ainsi une protection aux travailleurs et √† leurs familles."
                    },
                    {
                        question: "Quel organisme est charg√© de collecter les cotisations de s√©curit√© sociale et de les r√©partir entre les branches (maladie, vieillesse, famille, AT/MP) ?",
                        options: [
                            "France Travail.",
                            "La CNAV.",
                            "L'URSSAF.",
                            "L'AGIRC-ARRCO."
                        ],
                        correctAnswer: 2,
                        explanation: "L'<strong>URSSAF</strong> est l'organisme charg√© de collecter et de r√©partir les cotisations de s√©curit√© sociale."
                    },
                    {
                        question: "Le forfait social au taux de 20 % s'applique principalement √† :",
                        options: [
                            "L'int√©ressement et la participation des salari√©s.",
                            "Les heures suppl√©mentaires.",
                            "Les indemnit√©s de rupture conventionnelle.",
                            "Les heures compl√©mentaires."
                        ],
                        correctAnswer: 0,
                        explanation: "Le forfait social au taux de 20 % s'applique principalement aux sommes vers√©es au titre de l'<strong>√©pargne salariale, comme l'int√©ressement et la participation</strong>. Les heures suppl√©mentaires ou compl√©mentaires sont exon√©r√©es de forfait social. Les indemnit√©s de rupture conventionnelle ont un r√©gime sp√©cifique depuis le 1er septembre 2023 et ne sont plus soumises au forfait social au taux de 20 %."
                    },
                    {
                        question: "Le taux unique de la cotisation d'allocation familiale est-il √©gal √† 3,45 % ?",
                        options: [
                            "Vrai.",
                            "Faux."
                        ],
                        correctAnswer: 1,
                        explanation: "<strong>Faux</strong>. Le taux de la cotisation d'allocation familiale d√©pend du salaire du collaborateur. Il est r√©duit √† 3,45 % lorsque sa r√©mun√©ration brute est inf√©rieure ou √©gale √† 3,5 fois le SMIC annuel. Au-del√†, une majoration de 1,80 % s'applique, portant le taux √† 5,25 %."
                    },
                    {
                        question: "Quelle est la participation minimale de l'employeur √† la cotisation de mutuelle sant√© obligatoire ?",
                        options: [
                            "25% de la cotisation.",
                            "40% de la cotisation.",
                            "50% de la cotisation.",
                            "75% de la cotisation."
                        ],
                        correctAnswer: 2,
                        explanation: "La participation financi√®re de l'employeur √† la mutuelle sant√© obligatoire doit √™tre au moins √©gale √† <strong>50% de la cotisation</strong>."
                    },
                    {
                        question: "Quelle contribution patronale finance le d√©veloppement de la formation professionnelle et de l'apprentissage ?",
                        options: [
                            "La PEEC.",
                            "L'OETH.",
                            "La CUFPA.",
                            "La CRDS."
                        ],
                        correctAnswer: 2,
                        explanation: "La <strong>Contribution Unique √† la Formation Professionnelle et √† l'Alternance (CUFPA)</strong> finance le d√©veloppement de la formation professionnelle et de l'apprentissage."
                    }
                ]
            };

            // --- Learning Section State ---
            // Define all sections and their order
            let currentLearningSectionId = 'introduction'; 
            const sectionOrder = [
                'introduction',
                'cotisations-urssaf',
                'cotisations-agirc-arrco',
                'mutuelle-prevoyance',
                'contributions-patronales-annuelles',
                'essentiel-cotisations'
            ];
            const sectionCompletion = {
                "introduction": false,
                "cotisations-urssaf": false,
                "cotisations-agirc-arrco": false,
                "mutuelle-prevoyance": false,
                "contributions-patronales-annuelles": false,
                "essentiel-cotisations": false
            };

            // --- Mini-Quiz State ---
            let currentActiveQuizType = null; 
            let currentQuizQuestionIndex = 0;
            let miniQuizCorrectAnswersCount = 0;
            let currentQuizQuestionsSet = []; 

            // --- UI Elements ---
            const learningSections = document.querySelectorAll('.learning-section');
            const quizContainer = document.getElementById('quiz-container');
            const quizQuestionElement = document.getElementById('quiz-question');
            const quizOptionsElement = document.getElementById('quiz-options');
            const quizFeedbackElement = document.getElementById('quiz-feedback');
            const quizExplanationElement = document.getElementById('explanation-text'); 
            const explanationTextElement = document.getElementById('explanation-text');
            const submitButton = document.getElementById('submit-answer');
            const nextButton = document.getElementById('next-question');
            const startFinalQuizBtn = document.getElementById('start-final-quiz-btn');
            const finalQuizSection = document.getElementById('final-quiz-section');
            const finalQuizIntro = document.getElementById('final-quiz-intro');

            // --- Progress Bar Elements ---
            const dotIntroduction = document.getElementById('dot-introduction');
            const dotCotisationsUrssaf = document.getElementById('dot-cotisations-urssaf');
            const dotCotisationsAgircArrco = document.getElementById('dot-cotisations-agirc-arrco');
            const dotMutuellePrevoyance = document.getElementById('dot-mutuelle-prevoyance');
            const dotContributionsPatronalesAnnuelles = document.getElementById('dot-contributions-patronales-annuelles');
            const dotEssentielCotisations = document.getElementById('dot-essentiel-cotisations');
            const dotFinalQuiz = document.getElementById('dot-final-quiz');

            const lineIntroduction = document.getElementById('line-introduction');
            const lineCotisationsUrssaf = document.getElementById('line-cotisations-urssaf');
            const lineCotisationsAgircArrco = document.getElementById('line-cotisations-agirc-arrco');
            const lineMutuellePrevoyance = document.getElementById('line-mutuelle-prevoyance');
            const lineContributionsPatronalesAnnuelles = document.getElementById('line-contributions-patronales-annuelles');
            const lineEssentielCotisations = document.getElementById('line-essentiel-cotisations');

            const progressDots = {
                "introduction": dotIntroduction,
                "cotisations-urssaf": dotCotisationsUrssaf,
                "cotisations-agirc-arrco": dotCotisationsAgircArrco,
                "mutuelle-prevoyance": dotMutuellePrevoyance,
                "contributions-patronales-annuelles": dotContributionsPatronalesAnnuelles,
                "essentiel-cotisations": dotEssentielCotisations,
                "final-quiz": dotFinalQuiz
            };
            const progressLines = {
                "introduction": lineIntroduction,
                "cotisations-urssaf": lineCotisationsUrssaf,
                "cotisations-agirc-arrco": lineCotisationsAgircArrco,
                "mutuelle-prevoyance": lineMutuellePrevoyance,
                "contributions-patronales-annuelles": lineContributionsPatronalesAnnuelles,
                "essentiel-cotisations": lineEssentielCotisations
            };


            // --- Functions ---

            function updateProgressBar() {
                sectionOrder.forEach((sectionId, index) => {
                    const dot = progressDots[sectionId];
                    const line = progressLines[sectionId]; // Line *after* the dot

                    if (sectionCompletion[sectionId]) {
                        dot.classList.add('completed');
                        dot.classList.remove('active');
                        if (line) line.classList.add('completed');
                    } else if (sectionId === currentLearningSectionId) {
                        dot.classList.add('active');
                        dot.classList.remove('completed');
                    } else {
                        dot.classList.remove('active', 'completed');
                        if (line) line.classList.remove('completed');
                    }
                });

                // Final quiz dot
                const allSectionsCompleted = sectionOrder.every(id => sectionCompletion[id]);
                if (allSectionsCompleted) {
                    progressDots["final-quiz"].classList.add('active'); // Indicate it's ready
                } else {
                    progressDots["final-quiz"].classList.remove('active');
                }
            }

            function updateLearningSectionStates() {
                console.log('updateLearningSectionStates called. currentLearningSectionId:', currentLearningSectionId);
                learningSections.forEach(section => {
                    const sectionId = section.id;
                    const summarySpan = section.querySelector('summary span');
                    const validateBtn = section.querySelector('.validate-section-btn');
                    const miniQuizArea = section.querySelector('.mini-quiz-area');
                    const detailsElement = section.querySelector('details');

                    if (sectionId === currentLearningSectionId) {
                        section.classList.remove('section-locked');
                        section.style.borderColor = 'var(--accent-dark-color)';
                        if (summarySpan) summarySpan.style.color = 'var(--accent-dark-color)';
                        if (miniQuizArea) miniQuizArea.classList.remove('hidden');
                        if (detailsElement) detailsElement.open = true; // Open active section
                        // validateBtn is hidden by default in HTML, so no need to hide it here initially.
                        // It will be shown only when mini-quiz is 100% correct.

                        // Automatically start mini-quiz for the active section if not completed
                        if (!sectionCompletion[sectionId] && allQuizQuestions[sectionId] && allQuizQuestions[sectionId].length > 0) {
                            console.log(`Starting mini-quiz for section: ${sectionId}`);
                            startMiniQuiz(sectionId);
                        } else if (sectionCompletion[sectionId]) {
                            // If somehow active but already completed, hide quiz area
                            if (miniQuizArea) miniQuizArea.classList.add('hidden');
                        }

                    } else if (sectionCompletion[sectionId]) {
                        section.classList.remove('section-locked');
                        section.style.borderColor = '#388E3C'; /* Dark green for completed */
                        if (summarySpan) summarySpan.style.color = '#388E3C';
                        if (miniQuizArea) miniQuizArea.classList.add('hidden');
                        if (validateBtn) validateBtn.classList.add('hidden'); // Ensure hidden if completed
                        if (detailsElement) detailsElement.open = false; // Close completed section
                    } else {
                        section.classList.add('section-locked');
                        section.style.borderColor = '#CBD5E0'; /* Gray for locked */
                        if (summarySpan) summarySpan.style.color = '#607D8B';
                        if (miniQuizArea) miniQuizArea.classList.add('hidden');
                        if (validateBtn) validateBtn.classList.add('hidden'); // Ensure hidden if locked
                        if (detailsElement) detailsElement.open = false; // Keep locked sections closed
                    }
                });

                // Check if final quiz should be unlocked
                const allSectionsCompleted = sectionOrder.every(id => sectionCompletion[id]);
                if (allSectionsCompleted) {
                    finalQuizSection.classList.remove('section-locked');
                    finalQuizSection.style.borderColor = 'var(--accent-dark-color)';
                    finalQuizIntro.textContent = "F√©licitations ! Toutes les sections ont √©t√© valid√©es. Vous √™tes pr√™t pour le Quiz Final ! üéâ";
                    startFinalQuizBtn.classList.remove('hidden');
                } else {
                    finalQuizSection.classList.add('section-locked');
                    finalQuizSection.style.borderColor = '#CBD5E0'; /* Gray for locked */
                    finalQuizIntro.textContent = "Validez toutes les sections pr√©c√©dentes pour d√©bloquer le Quiz Final. üí°";
                    startFinalQuizBtn.classList.add('hidden');
                }

                updateProgressBar();
            }

            function loadQuizQuestion(quizSet, containerElementId) {
                currentQuizQuestionsSet = quizSet;
                const questionData = currentQuizQuestionsSet[currentQuizQuestionIndex];
                const container = document.getElementById(containerElementId);
                const totalQuestions = currentQuizQuestionsSet.length;

                container.innerHTML = `
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Question ${currentQuizQuestionIndex + 1} sur ${totalQuestions} : ${questionData.question}</h3>
                    <div class="space-y-3 mb-6" id="${containerElementId}-options"></div>
                    <div class="p-4 rounded-lg text-sm hidden" id="${containerElementId}-feedback"></div>
                    <div class="mt-4 p-4 bg-gray-50 rounded-lg text-sm text-gray-700 hidden" id="${containerElementId}-explanation">
                        <h4 class="font-bold mb-2">Explication D√©taill√©e üßê</h4>
                        <p id="${containerElementId}-explanation-text"></p>
                    </div>
                    <div class="mt-6 flex justify-between">
                        <button class="submit-quiz-answer-btn py-2 px-4 text-white rounded-lg font-semibold hover:opacity-90 transition" style="background-color: var(--accent-dark-color);">Valider la r√©ponse ‚úÖ</button>
                        <button class="next-quiz-question-btn py-2 px-4 bg-gray-300 text-gray-800 rounded-lg font-semibold hover:bg-gray-400 transition hidden">Question suivante ‚û°Ô∏è</button>
                    </div>
                `;

                const optionsContainer = document.getElementById(`${containerElementId}-options`);
                questionData.options.forEach((option, index) => {
                    const div = document.createElement('div');
                    div.className = 'quiz-option';
                    div.innerHTML = `
                        <input type="radio" id="${containerElementId}-option${index}" name="${containerElementId}-answer" value="${index}" class="hidden">
                        <label for="${containerElementId}-option${index}" class="block p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-100 transition">${option}</label>
                    `;
                    optionsContainer.appendChild(div);
                });

                // Add event listener for radio button changes to update visual feedback
                optionsContainer.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.addEventListener('change', (event) => {
                        optionsContainer.querySelectorAll('label').forEach(label => {
                            label.classList.remove('selected-option-visual'); // Remove from all
                            label.style.backgroundColor = ''; // Reset background
                            label.style.color = ''; // Reset text color
                        });
                        if (event.target.checked) {
                            const selectedLabel = optionsContainer.querySelector(`label[for="${event.target.id}"]`);
                            selectedLabel.classList.add('selected-option-visual'); // Add class for visual feedback
                            selectedLabel.style.backgroundColor = 'var(--accent-dark-color)'; // Apply dark accent
                            selectedLabel.style.color = '#FFFFFF'; // Apply white text
                        }
                    });
                });

                // Attach event listeners for the new buttons
                container.querySelector('.submit-quiz-answer-btn').addEventListener('click', () => submitQuizAnswer(containerElementId));
                container.querySelector('.next-quiz-question-btn').addEventListener('click', () => nextQuizQuestion(containerElementId));
            }

            function submitQuizAnswer(containerElementId) {
                console.log(`Submitting quiz answer for ${containerElementId}. Question index: ${currentQuizQuestionIndex}`);
                const container = document.getElementById(containerElementId);
                const selectedOption = container.querySelector(`input[name="${containerElementId}-answer"]:checked`);
                const feedbackElement = container.querySelector(`#${containerElementId}-feedback`);
                const explanationElement = container.querySelector(`#${containerElementId}-explanation`);
                const explanationText = container.querySelector(`#${containerElementId}-explanation-text`);
                const submitBtn = container.querySelector('.submit-quiz-answer-btn');
                const nextBtn = container.querySelector('.next-quiz-question-btn');
                const validateSectionBtn = document.querySelector(`#${currentActiveQuizType} .validate-section-btn`); 

                // Reset visual feedback for all options
                container.querySelectorAll('.quiz-option label').forEach(label => {
                    label.classList.remove('selected-option-visual');
                    label.style.backgroundColor = ''; // Reset background
                    label.style.color = ''; // Reset text color
                });


                if (!selectedOption) {
                    feedbackElement.textContent = "Veuillez s√©lectionner une r√©ponse.";
                    feedbackElement.className = 'p-4 rounded-lg text-sm bg-yellow-100 text-yellow-800';
                    feedbackElement.classList.remove('hidden');
                    return;
                }

                const selectedAnswerIndex = parseInt(selectedOption.value);
                const questionData = currentQuizQuestionsSet[currentQuizQuestionIndex];

                // Disable all radio buttons after submission
                container.querySelectorAll(`input[name="${containerElementId}-answer"]`).forEach(radio => radio.disabled = true);

                let isCorrect;
                if (Array.isArray(questionData.correctAnswer)) {
                    const selectedOptions = Array.from(container.querySelectorAll(`input[name="${containerElementId}-answer"]:checked`)).map(input => parseInt(input.value));
                    isCorrect = questionData.correctAnswer.length === selectedOptions.length &&
                                questionData.correctAnswer.every(val => selectedOptions.includes(val));
                } else {
                    isCorrect = (selectedAnswerIndex === questionData.correctAnswer);
                }

                if (isCorrect) {
                    feedbackElement.textContent = "Correct ! üéâ";
                    feedbackElement.className = 'quiz-feedback correct p-4 rounded-lg text-sm';
                    miniQuizCorrectAnswersCount++;
                } else {
                    feedbackElement.textContent = `Incorrect. La bonne r√©ponse √©tait : "${Array.isArray(questionData.correctAnswer) ? questionData.correctAnswer.map(idx => questionData.options[idx]).join(', ') : questionData.options[questionData.correctAnswer]}". üòî`;
                    feedbackElement.className = 'quiz-feedback incorrect p-4 rounded-lg text-sm';
                }
                feedbackElement.classList.remove('hidden');

                explanationText.innerHTML = questionData.explanation;
                explanationElement.classList.remove('hidden');
                
                submitBtn.classList.add('hidden');

                // Logic for showing Next Question or Validate Section / Retry buttons
                if (currentQuizQuestionIndex === currentQuizQuestionsSet.length - 1) {
                    console.log("This is the last question of the mini-quiz.");
                    nextBtn.classList.add('hidden'); // Hide next question button on last question
                    
                    if (miniQuizCorrectAnswersCount === currentQuizQuestionsSet.length) {
                        console.log("All questions correct. Showing Validate Section button.");
                        if (validateSectionBtn) validateSectionBtn.classList.remove('hidden');
                        document.getElementById(containerElementId).innerHTML += `<p class="text-green-700 font-semibold mt-4">Mini-quiz r√©ussi √† 100% ! Vous pouvez valider cette section. ‚úÖ</p>`;
                    } else {
                        console.log("Not all questions correct. Showing Retry button.");
                        document.getElementById(containerElementId).innerHTML += `
                            <p class="text-red-700 font-semibold mb-4 mt-4">Mini-quiz non r√©ussi (${miniQuizCorrectAnswersCount}/${currentQuizQuestionsSet.length} bonnes r√©ponses). Veuillez r√©essayer pour valider la section. üòî</p>
                            <button class="retry-mini-quiz-btn py-2 px-4 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition" data-section="${currentActiveQuizType}">R√©essayer le Mini-Quiz üîÑ</button>
                        `;
                        document.getElementById(containerElementId).querySelector('.retry-mini-quiz-btn').addEventListener('click', (e) => {
                            startMiniQuiz(e.target.dataset.section);
                        });
                    }
                } else {
                    nextBtn.classList.remove('hidden'); // Show next question button if not last
                }
            }

            function nextQuizQuestion(containerElementId) {
                console.log(`Moving to next quiz question for ${containerElementId}. Current index: ${currentQuizQuestionIndex}`);
                currentQuizQuestionIndex++;
                // Only load next question if there are more questions in the current set
                if (currentQuizQuestionIndex < currentQuizQuestionsSet.length) {
                    loadQuizQuestion(currentQuizQuestionsSet, containerElementId);
                } else {
                    // This block should ideally not be reached if submitQuizAnswer handles the last question correctly
                    // However, to prevent any unexpected behavior, we ensure quiz state is reset here.
                    console.warn("nextQuizQuestion reached end of quiz, but submitQuizAnswer should have handled this.");
                }
            }

            function startMiniQuiz(sectionId) {
                console.log(`Starting mini-quiz for section: ${sectionId}`);
                currentActiveQuizType = sectionId;
                currentQuizQuestionIndex = 0;
                miniQuizCorrectAnswersCount = 0;

                // Hide learning content, show mini-quiz area
                const detailsElement = document.querySelector(`#${sectionId} details`);
                if (detailsElement) detailsElement.open = false; // Close content
                const miniQuizArea = document.querySelector(`#${sectionId} .mini-quiz-area`);
                if (miniQuizArea) miniQuizArea.classList.remove('hidden');
                
                loadQuizQuestion(allQuizQuestions[sectionId], `mini-quiz-${sectionId}-container`);
            }

            function validateSection(sectionId) {
                console.log(`Validating section: ${sectionId}`);
                sectionCompletion[sectionId] = true;
                const sectionIndex = sectionOrder.indexOf(sectionId);
                
                // Hide mini-quiz area and validate button
                const miniQuizArea = document.querySelector(`#${sectionId} .mini-quiz-area`);
                if (miniQuizArea) miniQuizArea.classList.add('hidden');
                const validateBtn = document.querySelector(`#${sectionId} .validate-section-btn`);
                if (validateBtn) validateBtn.classList.add('hidden');

                // Reset quiz state for the section that was just validated
                currentActiveQuizType = null; 
                currentQuizQuestionIndex = 0; 
                miniQuizCorrectAnswersCount = 0; 

                updateLearningSectionStates(); // Update UI for current and next sections

                // Unlock next section if exists
                if (sectionIndex < sectionOrder.length - 1) {
                    currentLearningSectionId = sectionOrder[sectionIndex + 1];
                    console.log(`Next section to unlock: ${currentLearningSectionId}`);
                    updateLearningSectionStates(); // Re-run to unlock the next one
                    // Open the newly unlocked section's details
                    const nextSectionDetails = document.querySelector(`#${currentLearningSectionId} details`);
                    if (nextSectionDetails) nextSectionDetails.open = true;
                } else {
                    console.log("All sections completed. Final quiz should be active.");
                }
            }

            function startFinalQuiz() {
                console.log("Starting final quiz.");
                currentActiveQuizType = 'final-quiz'; 
                currentQuizQuestionIndex = 0;
                miniQuizCorrectAnswersCount = 0; 

                finalQuizIntro.classList.add('hidden');
                startFinalQuizBtn.classList.add('hidden');
                quizContainer.classList.remove('hidden');

                loadQuizQuestion(allQuizQuestions["final-quiz"], 'quiz-container'); 
            }


            // --- Event Listeners ---

            // Initial setup for learning sections
            updateLearningSectionStates();

            // Start mini-quiz for the first section on load
            if (currentLearningSectionId === 'introduction') {
                startMiniQuiz('introduction');
            }
            
            // Attach listeners to "Valider la Section" buttons
            document.querySelectorAll('.validate-section-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    validateSection(e.target.dataset.section);
                });
            });

            // Attach listener for the final quiz start button
            startFinalQuizBtn.addEventListener('click', startFinalQuiz);

        });
    </script>
</body>
</html>
